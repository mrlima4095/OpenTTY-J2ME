#!/bin/lua

-- Configurar variÃ¡veis de ambiente
for k,v in pairs({ 
    ["PATCH"] = "Fear Fog", 
    ["VERSION"] = getAppProperty("MIDlet-Version"), 
    ["RELEASE"] = "stable", 
    ["HOSTNAME"] = "localhost", 
    ["SHELL"] = "/bin/sh" 
}) do
    os.setenv(k, v)
end

for k,v in pairs({ 
    ["TYPE"] = "platform", 
    ["CONFIG"] = "configuration", 
    ["PROFILE"] = "profiles", 
    ["LOCALE"] = "locale" 
}) do
    os.setenv(k, getAppProperty("/microedition." .. v))
end

print("Iniciando OpenTTY " .. os.getenv("VERSION"))

-- Montar sistema de arquivos
local fstab = io.read("/etc/fstab")
if fstab and fstab ~= "" then
    io.mount(fstab)
    print("Sistema de arquivos montado")
end

-- Exibir MOTD
local motd = io.read("/etc/motd")
if motd and motd ~= "" then
    print(motd)
end

-- Criar interface
local xterm = graphics.new("screen", "OpenTTY " .. os.getenv("VERSION"))
local execute = graphics.new("command", { 
    label = "Run", 
    type = "ok", 
    priority = 1 
})

-- Configurar interface
graphics.append(xterm, io.stdout)
graphics.append(xterm, io.stdin)
graphics.addCommand(xterm, execute)

-- Handler simplificado
graphics.handler(xterm, {
    [execute] = function(args)
        if args and #args > 0 then
            local command = args[1]
            local status, result = io.popen(command, false)
            if result and result ~= "" then
                print(result)
            end
        end
    end
})

-- Exibir interface
graphics.display(xterm)
print("Interface pronta - use o comando Run para executar comandos")