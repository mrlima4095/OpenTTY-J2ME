#!/bin/lua

local function shell(args, enable, aliases, scope)
    local cmd, argument = string.getCommand(args), string.getArgument(args)
    args = string.split(argument, nil)

    if cmd == "" then
    elseif aliases[cmd] and enable then
        return shell(aliases[cmd] .. " " .. argument, enable, aliases, scope)
    elseif io.open("/bin/" .. cmd) then
        local res = io.popen("/bin/" .. cmd, argument, false, io.stdout)
        return res.status
    elseif cmd == "exit" then os.exit(nil)
    elseif cmd == "eval" then
        if argument == "" then
        else
            print(shell(argument))
        end
    elseif cmd == "echo" then print(argument)
    elseif cmd == "env" then print(os.getenv())
    elseif cmd == "clear" then
        graphics.SetText(io.stdout, "")
    
    -- File Utils
    elseif cmd == "cat" then
        for i = 1, #args do
            local file = io.open(args[i])
            if file then
                print(io.read(file))
            else
                print("cat: " .. args[i] .. ": not found")
                return 127
            end
        end
    -- 
    elseif cmd == "buff" then graphics.SetText(io.stdin, argument)

    else
        print(cmd .. ": not found")
        return 127
    end

    return 0
end

return shell