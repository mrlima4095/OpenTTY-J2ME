#!/bin/lua

if os.getpid("init") then
    os.exit(69)
end

for k,v in pairs({ ["PATCH"] = "Fear Fog", ["VERSION"] = getAppProperty("MIDlet-Version"), ["RELEASE"] = "stable", ["HOSTNAME"] = "localhost", ["SHELL"] = "/bin/sh" }) do
    os.setenv(k, v)
end

for k,v in pairs({ ["TYPE"] = "platform", ["CONFIG"] = "configuration", ["PROFILE"] = "profiles", ["LOCALE"] = "locale" }) do
    os.setenv(k, getAppProperty("/microedition." .. v))
end

graphics.vibrate(1000)
graphics.display(graphics.new("screen", "SandBox"))
graphics.SetTicker("gg")


local xterm = graphics.new("screen", "OpenTTY " .. os.getenv("VERSION"))
local run = graphics.new("command", { label = "Run", type = "ok", priority = 1 })

graphics.append(xterm, io.stdout)
graphics.append(xterm, io.stdin)
graphics.addCommand(xterm, run)
graphics.handler(xterm, {
    [run] = function(command)
        if command == "title" then
            graphics.SetTitle(xterm, string.getArgument(command))
        end

        if command ~= "" then
            io.popen("/bin/sh", command, false, io.stdout)
        end
    end
})

graphics.display(xterm)