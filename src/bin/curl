#!/bin/lua

local output = "/dev/stdout"
local follow_redirects, verbose = false, false
local url, method, data = "", "GET", ""
local headers = {}

if not arg[1] then
    print("curl: usage: curl [options] [url]")
end


local i = 1
while i <= #arg - 1 do
    local opt = arg[i]

    if opt == "-h" or opt == "--help" then
    elseif opt == "-X" then
        i = i + 1
        method = arg[i] or "GET"
        method = string.upper(method)
    elseif opt == "-H" then
        i = i + 1
        local line = arg[i] or ""
        local colon = string.find(line, ":")
        if colon then
            headers[string.trim(string.sub(line, 1, colon - 1))] = string.trim(string.sub(line, colon + 1))
        end
    elseif opt == "-d" then
        i = i + 1
        data = arg[i] or ""
    elseif opt == "-o" then
        i = i + 1
        output = arg[i] or ""
    elseif opt == "-L" then
        follow_redirects = true
    elseif opt == "-v" then
        verbose = true
    elseif string.sub(opt, 1, 1) == "-" then
        print("curl: option " .. opt .. ": is unknown")
        os.exit(2)
    else
        url = opt
    end
end

if url == "" then
    print("curl: no URL specified!")
    os.exit(2)
end

local body, request
if method == "GET" then
    body, request = socket.http.get()
elseif method == "POST" then

else
    print("curl: method " .. method .. ": is unsupported")
    os.exit(127)
end

