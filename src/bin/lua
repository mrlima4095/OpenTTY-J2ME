#!/bin/lua

local previous = graphics.getCurrent()
local scope = {}

local term = graphics.new("screen", "Lua J2ME")
local run = graphics.new("command", { label = "Run", type = "ok", priority = 1 })
local back = graphics.new("command", { label = "Back", type = "screen", priority = 1 })
local clear = graphics.new("command", { label = "Clear", type = "screen", priority = 1 })
local output = graphics.new("buffer", {})
local input =graphics.new("field", { type = "field", label = ">" })

io.setstdout(output)

graphics.append(term, output)
graphics.append(term, input)
graphics.addCommand(term, run)
graphics.addCommand(term, back)
graphics.addCommand(term, clear)
graphics.handler(term, {
    [run] = function(command)
        if command ~= "" then
            graphics.SetText(input, "")
            local ok, msg = pcall(load, command, scope)
            if not ok then
                print(msg)
            end
        end
    end,
    [back] = function()
        graphics.display(previous)
        os.exit()
    end,
    [clear] = function()
        graphics.SetText(output, "")
    end
})
graphics.display(term)
