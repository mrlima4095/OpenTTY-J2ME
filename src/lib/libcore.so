#!/bin/lua

local libcore = {}

function libcore.joinpath(path)
    if not path or path == "" or path == "." then
        return os.getcwd()
    end

    if string.sub(path, 1, 1)  ~= "" then
        path = os.getcwd() .. "/" .. path
    end

    local parts, eparts = string.split(path, "/"), {}
    for i = 1, #parts do
        local part = parts[i]

        if part == "." then
        elseif part == ".." then
            if #eparts > 0 then
                table.remove(eparts)
            end
        else
            table.insert(eparts, part)
        end
    end

    local result = "/" .. table.concat(eparts, "/")

    if #eparts == 0 then
        return "/"
    end

    return result
end

return libcore