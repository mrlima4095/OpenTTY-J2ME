#!/bin/lua


return function (ok, err, prev)
    local previous = prev or graphics.getCurrent()
    local screen = graphics.new("screen", "OpenTTY " .. os.getenv("VERSION"))
    local back = graphics.new("command", { label = "Back", type = "screen", priority = 1 })
    local run = graphics.new("command", { label = "Run", type = "ok", priority = 1 })

    graphics.append(screen, { type = "field", label = "[sudo] password for " .. java.midlet.username, mode = "password" })
    graphics.addCommand(screen, back)
    graphics.addCommand(screen, run)
    graphics.handler(screen, {
        [back] = function()
            graphics.display(previous)
        end,
        [run] = function(passwd)
            local status = os.su("root", passwd)
            if status == 0 then
                ok()
            else
                err()
            end
        end
    })
    graphics.display(screen)

end