#!/bin/lua

local app = {}

app.menu = function ()
    graphics.display(graphics.BuildList({
        back = { label = "Back", root = os.exit },
        button = {
            label = "Open",
            root = function (opt)
                if opt == "Monitor" then app.monitor()
                else os.execute("top") os.exit()
                end
            end
        },

        fields = { "Monitor", "Process" }
    }))
end

app.monitor = function()
    graphics.display(graphics.BuildScreen({
        back = { label = "Back", root = app.menu },
        button = { label = "Refresh", root = function () os.execute("gc") app.monitor() end },

        fields = {
            {
                type = "text",
                label = "Memory Status:",
                value = "Used Memory: " .. collectgarbage("count") .. "\\nFree Memory:" .. collectgarbage("free") .. "\\nTotal Memory: " .. collectgarbage("total")
            }
        }
    }))
end

if arg[1] == nil or arg[1] == "menu" then app.menu()
elseif arg[1] == "monitor" then app.monitor()
else print("htop: " .. arg[1] .. ": not found")
end