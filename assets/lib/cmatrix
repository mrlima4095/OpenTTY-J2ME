--[[

name=cmatrix
version=1.0
description=Matrix Effect

api.version=1.16
api.error=execute echo [ Matrix Effect ] This program requires OpenTTY 1.16 (Lua Runtime)
api.match=minimum 
api.nodes=lua

config=execute alias cmatrix=bg lua /home/cmatrix; cmatrix

]]

local function cmatrix()
    if os.getenv("J2EMU") ~= nil then error("cmatrix cannot run in j2me loader!") end

    local thr = os.execute("case thread (MIDlet) false")
    if tonumber(thr) == 255 then error("cmatrix cannot run in Main Thread") end

    os.execute("execute set OLD_TITLE=$TITLE; export CMATRIX; x11 stop; case !key (J2EMU) title hide; x11 xfinit stdout; clear; bg cron 20 unset CMATRIX; true")

    while os.getenv("CMATRIX") do
        local x = random(10)

        io.write(x .. " ", "stdout", "a")

        if string.len(io.read()) > 200 then os.execute("clear") end
    end

    os.execute("execute x11 stop; x11 init; title $OLD_TITLE; clear;")
end

os.setproc("name", "cmatrix")
cmatrix()