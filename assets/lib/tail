#!/bin/lua

local function split(text, delimiter)
    if text == nil then return {} end
    delimiter = delimiter or " "

    local parts = {}
    local current = 1
    local length = #text
    local delim_len = #delimiter

    if delim_len == 0 then
        for i = 1, length do
            parts[i] = string.sub(text, i, i)
        end
        return parts
    end

    while current <= length do
        local found = string.find(text, delimiter, current, true)

        if not found then
            parts[#parts + 1] = string.sub(text, current)
            break
        end

        parts[#parts + 1] = string.sub(text, current, found - 1)
        current = found + delim_len
    end

    return parts
end

local count = tonumber(arg[2]) or 10

if arg[1] then
    local file = io.open(arg[1])
    if file then
        io.write("tail: " .. arg[1] .. ": not found")
        os.exit(127)
    end

    local content = io.read(file)
    local lines = split(content, "\n")
    local start = math.max(1, #lines - count + 1)

    for i = start, #lines do
        print(lines[i])
    end
else
    print("tail [file]")
end